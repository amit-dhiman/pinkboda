<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Houzmart</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <link rel="shortcut icon" href="/images/" type="image/x-icon"> -->

    <!-- Bootstrap CSS v5.2.0-beta1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <!-- custom css -->
    <link rel="stylesheet" href="/assets/css/styles.css" />
  </head>

  <body>
    <div class="container-fluid">
      <div class="row flex-nowrap">
        <div class="col-md-3 left-sidebar" id="left">
          <div class="pt-5">
            <div class="row">
              <div class="col-md-4"></div>
              <div class="col-md-4">
                <a href="" class="">
                  <img class="logo_img" src="/images/logo.png" width="100px" />
                </a>
              </div>
            </div>
            <div class="col-md-4"></div>
            <hr class="line" />
            <ul class="nav nav-pills flex-column" id="menu">
              <li class="nav-item active" id="project_feed">
                <a href="/admin/renderIndex" class="nav-link align-middle"><img src="/images/users.png" width="20px"/><span class="ms-3">All User</span></a>
              </li>
              <li class="nav-item" id="Membership">
                <a href="/admin/renderRider" class="nav-link align-middle"> <img src="/images/rider.png" width="20px"/><span class="ms-3">Riders</span></a>
              </li>
              <li class="nav-item" id="Photo_feed">
                <a href="/admin/renderDriver" class="nav-link align-middle"> <img src="/images/driver.png" width="20px"/><span class="ms-3">Drivers</span></a>
              </li>
              <li class="nav-item" id="Askbob">
                <a href="/admin/renderHelpSupport" class="nav-link align-middle"><img src="/images/help.png" width="20px"/><span class="ms-3">Manage Help & Support</span></a>
              </li>
              <li class="nav-item" id="Membership">
                <a href="/admin/Terms&Conditions.ejs" class="nav-link align-middle"><img src="/images/term.png" width="17px"/><span class="ms-3">Terms & Conditions</span></a>
              </li>
              <li class="nav-item" id="Photo_feed">
                <a href="/admin/massPushPage" class="nav-link align-middle"> <img src="/images/mass.png" width="17px"/><span class="ms-3">Mass push</span></a>
              </li>
              <li class="nav-item" id="Askbob">
                <a href="/admin/renderProfile" class="nav-link align-middle"> <img src="/images/profile.png" width="17px"/><span class="ms-3">Profile</span></a>
              </li>
            </ul>
          </div>
        </div>

        <div class="col-md-9 mt-4">
          <div class="row">
            <nav class="navbar">
              <div class="container-fluid">
                <a class="navbar-brand" href="#"></a>
                <button class="navbar-toggler" id="toggle" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
              </div>
            </nav>
            <div class="col-md-8">
              <div class="search-bar">
                <img src="/images/search.png" />
                <input type="search" id="searchInput" class="form-control search" placeholder="Search" />
              </div>
            </div>
            <div class="col-md-1">
              <div class="col-md-2 col-2">
                <div class="action">
                  <img class="notification-img" src="/images/notifications.png" width="20px" onclick="menuToggle();" />
                  <div class="menu">
                    <h2>Notifications</h2>
                    <div class="row g-3">
                      <div class="col-md-2">
                        <img class="img-notification" src="/images/notification1.png" />
                      </div>
                      <div class="col-md-9">
                        <h3 class="mess-txt"><span class="notification-txt">Elend Grod</span> sent you message</h3>
                        <p class="date-time">10/02/22 2:31 AM</p>
                      </div>
                      <div class="col-md-2">
                        <img class="img-notification" src="/images/notification2.png" />
                      </div>
                      <div class="col-md-9">
                        <h3 class="mess-txt"><span class="notification-txt">Jiyo lead</span> sent you message</h3>
                        <p class="date-time">10/02/22 2:31 AM</p>
                      </div>
                      <div class="col-md-2">
                        <img class="img-notification" src="/images/notification3.png" />
                      </div>
                      <div class="col-md-9">
                        <h3 class="mess-txt"><span class="notification-txt">Kixklo</span> sent you message</h3>
                        <p class="date-time">10/02/22 2:31 AM</p>
                      </div>
                      <div class="col-md-2">
                        <img class="img-notification" src="/images/notification4.png" />
                      </div>
                      <div class="col-md-9">
                        <h3 class="mess-txt"><span class="notification-txt">Leika Bask</span> sent you message</h3>
                        <p class="date-time">10/02/22 2:31 AM</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3 d-flex justify-content-center align-items-center">
              <img class="img-profile" src="/uploads/admin/<%= getAdmin.profile_image %>" />
              <ul class="nav navbar-nav ms-auto" style="width: 67%">
                <li class="nav-item dropdown">
                  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Markous</a>
                  <div class="dropdown-menu dropdown-menu-end">
                    <div class="locker_img d-flex justify-content-center align-items-center">
                      <img src="/images/lock.png" />
                      <a href="/admin/getChangePasswordPage" class="dropdown-item">Change Password</a>
                    </div>
                    <div class="locker_img d-flex justify-content-center align-items-center">
                      <img src="/images/logout.png" />
                      <a href="/admin/logout" class="dropdown-item" style="color: #ff0000" ;>Logout</a>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="right-sidebar1">
              <div class="riders_tab">
                <ul class="nav nav-tabs driver" id="myTab">
                  <li class="nav-item project_tab">
                    <a href="#drivers" class="nav-link active" data-bs-toggle="tab">My drivers</a>
                  </li>
                  <li class="nav-item project-tab">
                    <a href="#requests" class="nav-link" data-bs-toggle="tab">Pending requests</a>
                  </li>
                </ul>
                <div class="tab-content table-responsive">
                  <div class="tab-pane fade show active" id="drivers">
                    <table class="table driver">
                      <thead>
                        <tr class="tabl-size">
                          <th scope="col">Driver Profile</th>
                          <th scope="col">Full Name</th>
                          <th scope="col">Gender</th>
                          <th scope="col"><a href="http://161.97.132.85/Designing/Houzmart_admin/Total_riders.ejs">Total Ride</a></th>
                          <th scope="col">Passport photo</th>
                          <th scope="col">ID Card</th>
                          <th scope="col">License</th>
                          <th scope="col">Insurance</th>
                          <th scope="col">License Year</th>
                          <th scope="col">Complaint</th>
                          <th scope="col"><a href="http://161.97.132.85/Designing/Houzmart_admin/total_earning.ejs">Total Earning</a></th>
                          <th scope="col">Signup date</th>
                          <th scope="col">Action</th>
                          <th scope="col">Contact</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="tabl_size">
                          <th scope="row" class="d-flex justify-content-center"><img class="profile_img" src="/images/img.png" /></th>
                          <td>Waloi</td>
                          <td>Male</td>
                          <td>2</td>
                          <th scope="row" class="d-flex justify-content-center"><img class="passport_img" src="/images/pasport.png" /></th>
                          <th scope="row"><img class="idcard_img" src="/images/idcard.png" /></th>
                          <th scope="row"><img class="license_img" src="/images/license.png" /></th>
                          <td>2023</td>
                          <td>425 AIY</td>
                          <td>N/A</td>
                          <td>$2030</td>
                          <td>23 Jun, 2023</td>
                          <td><button class="btn btn-info data" type="button">Disable</button></td>
                          <td>565646564</td>
                        </tr>
                        <% for(let driver of getDrivers) { %>
                          <% const formattedDate = new Date(driver.created_at).toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' }); %>
                          <tr class="tabl_size">
                            <th scope="row" class="d-flex justify-content-center"><img class="profile_img" src="<%=driverImageUrl + driver.profile_image %>" /></th>
                            <td><%=driver.username %></td>
                            <td><%=driver.gender %></td>
                            <td><%=driver.total_rides %></td>
                            <th scope="row" class="d-flex justify-content-center"><img class="passport_img" src="<%=driverImageUrl + driver.passport_photo %>"/></th>
                            <th scope="row"><img class="idcard_img" src="<%=driverImageUrl + driver.id_card %>" /></th>
                            <th scope="row"><img class="license_img" src="<%=driverImageUrl + driver.license %>"/></th>
                            <th scope="row"><img class="license_img" src="<%=driverImageUrl + driver.vechile_insurance %>"/></th>
                            <td><%= driver.year %></td>
                            <td>N/A</td>      <!-- have to add complaints here -->
                            <td>$2030</td>    <!-- have to total earning here -->
                            <td><%= formattedDate %></td>
                            <td><button class="btn btn-info data" type="button" onclick="updateButton(this,'<%= driver.id %>')"><%= driver.action %></button></td>
                            <td><%= driver.mobile_number %></td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                  <div class="tab-pane fade" id="requests">
                    <table class="table"  id="requests_table">
                      <thead>
                        <tr class="tabl-size">
                          <th scope="col">Driver Profile</th>
                          <th scope="col">Full Name</th>
                          <th scope="col">Gender</th>
                          <th scope="col">Insurance</th>
                          <th scope="col">Passport photo</th>
                          <th scope="col">ID Card</th>
                          <th scope="col">License</th>
                          <th scope="col">Request Date</th>
                          <th scope="col"></th>
                          <th scope="col"></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="tabl_size">
                          <th scope="row" class="d-flex justify-content-center"><img class="profile_img" src="/images/img.png" /></th>
                          <td>Waloi</td>
                          <td>Male</td>
                          <th scope="row"><img class="insurance_img" src="/images/insurance.png" /></th>
                          <th scope="row" class="d-flex justify-content-center"><img class="passport_img" src="/images/pasport.png" /></th>
                          <th scope="row"><img class="idcard_img" src="/images/idcard.png" /></th>
                          <th scope="row"><img class="license_img" src="/images/license.png" /></th>
                          <td>23 Jun, 2023</td>
                          <td><button class="btn btn-info accept" type="button">Accept</button></td>
                          <td><button class="btn btn-info reject" type="button">Reject</button></td>
                        </tr>
                        <% for(let pending of pendingRequests) { %>
                          <% const formattedDate = new Date(pending.created_at).toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' }); %>
                          <tr class="tabl_size">
                            <th scope="row" class="d-flex justify-content-center"><img class="profile_img" src="/uploads/drivers/<%=pending.profile_image %>"/></th>
                            <td><%=pending.username %></td>
                            <td><%=pending.gender %></td>
                            <th scope="row"><img class="license_img" src="<%=driverImageUrl + pending.vechile_insurance %>"/></th>
                            <th scope="row" class="d-flex justify-content-center"><img class="passport_img" src="<%=driverImageUrl + pending.passport_photo %>"/></th>
                            <th scope="row"><img class="idcard_img" src="<%=driverImageUrl + pending.id_card %>" /></th>
                            <th scope="row"><img class="license_img" src="<%=driverImageUrl + pending.license %>"/></th>
                            <td><%= formattedDate %></td>
                            <!-- <td><button class="btn btn-info data" type="button" onclick="updateButton(this,'<%= pending.id %>')"><%= pending.action %></button></td> -->
                            <td><button class="btn btn-info accept" type="button" onclick="updatePendingReq(this,'<%= pending.id %>','accepted')">Accept</button></td>
                            <td><button class="btn btn-info reject" type="button" onclick="updatePendingReq(this,'<%= pending.id %>','rejected')">Reject</button></td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function menuToggle() {
    const toggleMenu = document.querySelector(".menu");
    toggleMenu.classList.toggle("active");
  }
</script>
<script>
  const toggle = document.getElementById("toggle");
  const left = document.getElementById("left");
  const bodyClass = document.querySelector("body");
  toggle.onclick = function () {
    toggle.classList.toggle("active");
    left.classList.toggle("active");
    bodyClass.classList.toggle("bodyOverflow");
  };

function updateButton(button, driverId) {
  fetch(`/admin/actionOnDriver/${driverId}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      // console.log('----------response-----------',response);
      return response.text();
    })
    .then(newButtonText => {
      // console.log('---------newButtonText---------',newButtonText);
      // console.log('---------button---------',button);
      button.textContent = newButtonText;
    })
    .catch(error => {
      console.error('Error occurred while updating the button:', error);
    })
}

function updatePendingReq(button, driverId,action) {
  fetch(`/admin/pendingRequests?pendingAction=${action}&driverId=${driverId}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.text();
    })
    .then(() => {
      button.parentNode.parentNode.remove();
    }).catch(error => {
      console.error('Error occurred while updating the button:', error);
    })
}

const searchInput = document.getElementById("searchInput");

const originalData = {};
const dataTableInstances = {};

document.addEventListener("DOMContentLoaded", function() {
  // Initialize all DataTables
  const tableIds = ["example", "example1", "example2"];

  tableIds.forEach(tableId => {
    const table = document.getElementById(tableId);
    if (table) {
      const tableRows = document.querySelectorAll(`#${tableId} .tabl_size`);
      originalData[tableId] = Array.from(tableRows);

      dataTableInstances[tableId] = new DataTable(table, {
        columnDefs: [{ orderable: false, targets: 4 }],
        language: {
          paginate: {
            previous: '<span class="fa fa-chevron-left"></span>',
            next: '<span class="fa fa-chevron-right"></span>'
          },
          lengthMenu: 'Display <select class="form-control input-sm">' +
            '<option value="10">10</option>' +
            '<option value="20">20</option>' +
            '<option value="30">30</option>' +
            '<option value="40">40</option>' +
            '<option value="50">50</option>' +
            '<option value="-1">All</option>' +
            '</select> results'
        }
      });
    }
  });

  // Add an input event listener to the shared search input
  searchInput.addEventListener('input', function () {
    const searchValue = searchInput.value.toLowerCase();
    
    // Iterate through each table
    tableIds.forEach(tableId => {
      const matchingRows = originalData[tableId].filter(row => {
        const fullNameCell = row.querySelector('td:nth-child(2)');
        return fullNameCell.textContent.toLowerCase().includes(searchValue);
      });

      // Clear and update the specific DataTable for this table
      if (dataTableInstances[tableId]) {
        dataTableInstances[tableId].clear();
        dataTableInstances[tableId].rows.add(matchingRows);
        dataTableInstances[tableId].draw();
      }
    });
  });
});


</script>
</body>
</html>
